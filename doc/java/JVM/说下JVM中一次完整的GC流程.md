# 说下JVM中一次完整的 GC 流程

JVM中的垃圾回收是自动进行的，它的目标是回收不再使用的对象，释放内存空间，并且保证程序的正常运行。下面是一次完整的GC流程的一般步骤：

1. 标记阶段：GC从根对象开始，通过根对象的引用链，标记所有可达的对象。根对象包括活动线程的栈帧中的局部变量、静态变量、JNI引用等。
2. 垃圾标记：在标记阶段完成后，GC会确定哪些对象是垃圾对象，即不可达对象。这些对象将被标记为垃圾，可以被回收。
3. 垃圾回收：在标记阶段完成后，GC会执行垃圾回收操作，回收被标记为垃圾的对象所占用的内存空间。回收的方式有不同的算法，例如标记-清除、复制、标记-整理等。
4. 内存整理：在垃圾回收完成后，可能会产生内存碎片。为了提高内存的利用率，GC可能会对内存空间进行整理，将存活的对象紧凑地排列在一起，以便更好地分配新的对象。
5. 内存分配：在垃圾回收和内存整理完成后，GC会为新的对象分配内存空间。分配的方式有不同的算法，例如指针碰撞、空闲列表等。
6. 重新分配对象引用：在垃圾回收和内存分配完成后，GC会更新对象之间的引用关系，确保引用指向正确的对象。

以上是一次完整的GC流程的一般步骤。不同的GC算法和实现可能会有所差异，但整体的流程大致相同。GC的目标是回收垃圾对象，释放内存空间，并且尽量减少对应用程序的影响，保证程序的正常运行。


> 原文: <https://www.yuque.com/tulingzhouyu/db22bv/qy0y5pewbrrvd926>
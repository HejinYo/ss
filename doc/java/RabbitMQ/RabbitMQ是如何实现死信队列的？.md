# RabbitMQ 是如何实现死信队列的？

 死信队列是 RabbitMQ 提供的一种特殊序列，处理那些无法被正常消费的消息。有三种情况会产生死信：

- 消息被消费者明确拒绝。
- 消息达到预设的过期时间仍没有消费者消费。
- 消息由于队列已经达到最大长度限制而被丢弃。

在 RabbitMQ 中，实现死信队列只需要给正常队列增加三个核心参数即可：

1. dead-letter-exchange：指定当前队列对应的死信队列
2. dead-letter-routing-key：指定消息转入死信队列时的路由键
3. message-ttl：消息在队列中的过期时间。

接下来，就可以往正常队列中发送消息。如果消息满足了某些条件，就会成为死信，并被重新发送到对应的死信队列中。而此时，RabbitMQ 会在消息的头部添加一些与死信相关的补充信息，例如时间、成为死信的原因、原队列等。应用程序可以按需处理这些补充的信息。
最后，死信队列中的消息都是正常业务处理失败的消息，应用程序需要创建一个消费者来专门处理这些被遗漏的消息。例如记录日志、发送警报等。这样才能保证业务数据的完整性。


> 原文: <https://www.yuque.com/tulingzhouyu/db22bv/pv3vqkfhxeub13f5>
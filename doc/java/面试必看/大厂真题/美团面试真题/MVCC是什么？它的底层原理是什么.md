# MVCC 是什么？它的底层原理是什么

MVCC（Multi-Version Concurrency Control），即多版本并发控制，是一种数据库的并发控制机制。它的目标是在保证数据一致性和隔离性的同时，提供更好的并发性能。
MVCC的底层原理如下：

1. 每一行数据都有多个版本：在MVCC中，每个数据行都会维护多个版本。每当对一行数据进行更新操作时，不会直接覆盖原来的数据，而是会生成新的版本。每个版本都有一个时间戳，用于标识该版本的创建时间。
2. 读操作只读取符合时间条件的版本：在读取数据时，事务只能看到创建时间早于事务开始时间的版本。这样可以保证事务读取的数据是一致的，不会受到其他事务的影响。
3. 写操作保存多个版本：当进行写操作时，会生成新的版本并更新到数据行中。旧的版本仍然存在，不会被删除。这样做的好处是，其他正在进行的事务可以继续读取到旧的版本，不会被阻塞。
4. 版本控制：为了维护数据的一致性和隔离性，MVCC使用了版本控制机制。事务开始时，会记录当前的最新版本号。在事务执行过程中，只能读取到版本号小于等于事务开始时的版本。这样可以保证读取的数据在事务开始时是一致的。
5. 垃圾回收：为了防止旧的版本无限增加，增加数据库的存储空间，MVCC采用了垃圾回收机制。当一个事务提交时，系统会检查该事务产生的版本是否还有其他事务正在使用。如果没有，那么该版本就可以被删除，释放空间。

通过使用MVCC，数据库能够提供更好的并发性能。每个事务可以独立地读取和修改数据，不会相互干扰。在MVCC的机制下，读操作不会被写操作阻塞，并且可以实现更高的并发度。

 


> 原文: <https://www.yuque.com/tulingzhouyu/db22bv/imvzgquf4f1ggyor>
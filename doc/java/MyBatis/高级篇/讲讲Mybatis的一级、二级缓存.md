# 讲讲Mybatis 的一级、二级缓存

MyBatis提供了两种级别的缓存：一级缓存（本地缓存）和二级缓存（全局缓存）。它们分别位于不同的作用范围，有不同的特性和使用场景。

### 一级缓存（本地缓存）：

1.  **作用范围：** 一级缓存是在`SqlSession`的生命周期内有效，也就是说，每个`SqlSession`拥有独立的一级缓存。 
2.  **默认开启：** 一级缓存在MyBatis中默认是开启的，无需额外配置。 
3.  **特点：** 当执行查询操作时，查询的结果会被缓存在当前`SqlSession`中。如果再次执行相同的查询，MyBatis会首先尝试从缓存中获取数据，而不再访问数据库。 
4.  **自动刷新：** MyBatis会在执行insert、update、delete等写操作时自动清空一级缓存，以保持数据的一致性。 

### 二级缓存（全局缓存）：

1.  **作用范围：** 二级缓存是在多个`SqlSession`之间共享的，即多个`SqlSession`可以共享同一个二级缓存。 
2.  **配置开启：** 二级缓存需要手动配置开启，需要在映射文件的`<mapper>`标签下添加`<cache>`元素。 
```xml
<cache eviction="LRU" flushInterval="60000" size="1024" readOnly="true"/>
```
 

3.  **特点：** 二级缓存能够跨`SqlSession`共享查询结果，有效减少数据库访问次数。它的数据存储在全局范围的缓存中，可以由多个`SqlSession`访问。 
4.  **缓存策略：** 你可以根据需求选择不同的缓存策略（例如`LRU`、`FIFO`等），以及配置缓存的大小、刷新间隔等参数。 
5.  **注意事项：** 二级缓存可以缓存的对象需要是可序列化的，要确保对象可以正确地序列化和反序列化。另外，对于关联数据的更新操作，需要手动清除相关的二级缓存，以避免脏数据的问题。 

需要注意的是，虽然缓存可以提高查询性能，但不合理的使用缓存可能导致数据不一致等问题，特别是在分布式环境下。因此，在使用缓存时需要根据业务需求和性能测试结果进行合理的配置和管理。


> 原文: <https://www.yuque.com/tulingzhouyu/db22bv/hqr8yfn6600ia9bo>
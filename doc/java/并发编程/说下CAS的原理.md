# 说下CAS的原理

CAS（Compare And Swap）是一种乐观的并发控制机制，它的核心原理是基于硬件层面的原子性保证。CAS操作包含三个操作数——内存位置（V）、预期原值（A）和新值（B）。它的**工作原理**是：

1. 在将新值写入内存之前，CAS操作会先比较内存位置的值是否与预期原值相匹配。
2. 如果内存位置的值与预期原值相匹配，那么处理器会自动将该位置的值更新为新值。
3. 如果内存位置的值与预期原值不匹配，则CAS操作失败，不会修改内存值。

**CAS的优势在于它没有阻塞状态，不会引起线程上下文的切换和调度问题。**然而，CAS也存在一些缺点，例如**ABA问题和开销问题**。ABA问题是指一个值原来是A，变成了B，又变成了A，那么使用CAS进行检查时会发现它的值没有发生变化，但是实际上却变化了。开销问题则是因为CAS自旋操作需要不断轮询内存位置，直到成功为止，这会消耗大量的CPU资源。


> 原文: <https://www.yuque.com/tulingzhouyu/db22bv/rf6z3cwdvsus3wk3>